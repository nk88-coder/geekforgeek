<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fraud Prediction Demo</title>
    <link rel="stylesheet" href="/static/style.css" />
    <!-- Chart.js for plotting transaction history -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      details summary { color: #00d4ff; cursor: pointer; font-weight: 600; padding: 6px 8px; transition: all 0.2s ease; }
      details summary:hover { text-shadow: 0 0 10px rgba(0,212,255,0.6); }
      details[open] summary { color: #00d4ff; }
    </style>
  </head>
  <body>
    <main class="container">
      <h1>Fraud Prediction</h1>

      <div class="grid">
        <div class="left">
          <div class="instructions">
            <p>Actual prediction starts from the 3rd or 4th transaction. This fraud detection system is based on amount deviation from previous transactions. It considers factors such as distance (inside city, inter city, or outside country), merchant type, time of day (midnight or morning transactions might be flagged as fraud), and device type. Combining all these features, the ML model is trained and ready to predict if a transaction might be fraudulent or risky.</p>
          </div>
          <form id="txnForm">
        <div class="row"><label>User ID<input name="user_id" placeholder="user_1" required></label></div>
        <div class="row"><label>Transaction ID<input name="transaction_id" placeholder="txn_123" required></label></div>
        <div class="row"><label>Amount<input name="amount" type="number" step="0.01" placeholder="0.00" required></label></div>
        <div class="row"><label>Transaction Type
          <select name="transaction_type" required>
            <option value="">Select type</option>
            <option value="UPI">UPI</option>
            <option value="CARD">CARD</option>
            <option value="NETBANKING">NETBANKING</option>
          </select>
        </label></div>
        <div class="row"><label>Merchant Category
          <select name="merchant_category" required>
            <option value="">Select category</option>
            <option value="food">Food</option>
            <option value="grocery">Grocery</option>
            <option value="electronics">Electronics</option>
            <option value="travel">Travel</option>
            <option value="entertainment">Entertainment</option>
            <option value="clothing">Clothing</option>
            <option value="health care">Health Care</option>
          </select>
        </label></div>
        <div class="row"><label>Location
          <select name="location" required>
            <option value="">Select location</option>
            <option value="0">Inside City</option>
            <option value="1">Inter City</option>
            <option value="2">Outside Country</option>
          </select>
        </label></div>
  <!-- Removed Session Length input as it's now hardcoded in backend -->
  <!-- Removed Is New Device input because backend now determines it dynamically -->
  <!-- Removed Avg Daily Transactions (30d), Amount Deviation Score, and Transactions Today as they are now auto-calculated in backend -->

        <div class="row actions">
          <button type="submit">Predict</button>
        </div>
      </form>

        </div>
        <div class="right">
          <section>
            <h2>Result</h2>
            <div id="resultCard" class="card">
              <div id="txInfo" class="card-section"></div>
              <div id="computedFeatures" class="card-section"></div>
              <div id="predictionInfo" class="card-section"></div>
              <details class="card-section" id="rawJsonSection"><summary>Raw JSON</summary><pre id="rawJson">No prediction yet.</pre></details>
            </div>
          </section>

          <section>
            <h2>Transaction History</h2>
            <canvas id="txnChart" height="160"></canvas>
            <div class="table-container">
              <table id="txnTable">
                <thead>
                  <tr>
                    <th>Txn ID</th>
                    <th>Amount</th>
                    <th>Timestamp</th>
                    <th>Type</th>
                    <th>Merchant</th>
                    <th>Dev Flag</th>
                    <th>Pred</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>
      <section id="shapSection" style="display:none;">
        <h2>SHAP Explanation (Top contributors)</h2>
        <ul id="shapList"></ul>
      </section>
    </main>

    <script src="/static/app.js"></script>
  </body>
</html>
